<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualisasi Single Linked List</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom scrollbar for better aesthetics */
      .visualizer-scrollbar::-webkit-scrollbar {
        height: 8px;
      }
      .visualizer-scrollbar::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 10px;
      }
      .visualizer-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
      }
      .visualizer-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-sky-100 to-teal-100 text-gray-800 font-sans flex flex-col min-h-screen"
  >
    <!-- Header -->
    <header
      class="bg-white/70 backdrop-blur-sm p-4 shadow-md text-center sticky top-0 z-20"
    >
      <h1 class="text-2xl font-bold text-teal-600">
        Visualisasi Single Linked List
      </h1>
      <div class="text-sm text-gray-600 mt-1">
        <span>Jumlah Node: <span id="node-count">0</span></span>
        <span class="mx-2">|</span>
        <span>Head: <span id="head-name">null</span></span>
        <span class="mx-2">|</span>
        <span>Tail: <span id="tail-name">null</span></span>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 flex flex-col overflow-hidden">
      <p
        id="message-bar"
        class="text-center text-sky-700 h-6 mb-4 transition-opacity duration-300 font-semibold"
      ></p>

      <!-- Visualizer Area -->
      <div
        id="visualizer"
        class="flex-grow w-full flex items-center overflow-x-auto p-4 bg-black/5 rounded-lg visualizer-scrollbar"
      >
        <!-- Nodes will be dynamically inserted here by JavaScript -->
      </div>
    </main>

    <!-- Control Button -->
    <footer class="p-4 sticky bottom-0 z-20">
      <button
        id="control-button"
        class="w-full max-w-md mx-auto flex items-center justify-center space-x-2 bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:scale-100"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        <span>Kontrol / Aksi</span>
      </button>
    </footer>

    <!-- Action Modal (Bottom Sheet) -->
    <div
      id="modal-backdrop"
      class="fixed inset-0 bg-black bg-opacity-50 z-30 transition-opacity duration-300 opacity-0 pointer-events-none"
    ></div>
    <div
      id="modal-sheet"
      class="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl p-6 z-40 transform transition-transform duration-300 ease-out translate-y-full"
    >
      <h2 class="text-xl font-bold text-center mb-4 text-teal-600">
        Pilih Aksi
      </h2>

      <form id="action-form-container" class="hidden mb-4 space-y-3">
        <div id="form-fields">
          <!-- Form inputs will be dynamically inserted here -->
        </div>
        <div class="flex space-x-2 pt-2">
          <button
            id="submit-action-button"
            type="submit"
            class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors"
          >
            Jalankan Aksi
          </button>
          <button
            id="cancel-action-button"
            type="button"
            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition-colors"
          >
            Batal
          </button>
        </div>
      </form>

      <div
        id="action-buttons-grid"
        class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm"
      >
        <button
          data-action="addFirst"
          class="bg-gray-100 hover:bg-teal-100 p-3 rounded-lg transition-colors"
        >
          Tambah Awal
        </button>
        <button
          data-action="addLast"
          class="bg-gray-100 hover:bg-teal-100 p-3 rounded-lg transition-colors"
        >
          Tambah Akhir
        </button>
        <button
          data-action="addMiddle"
          class="bg-gray-100 hover:bg-teal-100 p-3 rounded-lg transition-colors"
        >
          Tambah Tengah
        </button>
        <button
          data-action="editFirst"
          class="bg-gray-100 hover:bg-sky-200 p-3 rounded-lg transition-colors"
        >
          Ubah Awal
        </button>
        <button
          data-action="editLast"
          class="bg-gray-100 hover:bg-sky-200 p-3 rounded-lg transition-colors"
        >
          Ubah Akhir
        </button>
        <button
          data-action="editMiddle"
          class="bg-gray-100 hover:bg-sky-200 p-3 rounded-lg transition-colors"
        >
          Ubah Tengah
        </button>
        <button
          data-action="deleteFirst"
          class="bg-gray-100 hover:bg-red-200 p-3 rounded-lg transition-colors"
        >
          Hapus Awal
        </button>
        <button
          data-action="deleteLast"
          class="bg-gray-100 hover:bg-red-200 p-3 rounded-lg transition-colors"
        >
          Hapus Akhir
        </button>
        <button
          data-action="deleteMiddle"
          class="bg-gray-100 hover:bg-red-200 p-3 rounded-lg transition-colors"
        >
          Hapus Tengah
        </button>
        <button
          data-action="resetData"
          class="bg-gray-200 hover:bg-sky-300 p-3 rounded-lg transition-colors col-span-1 md:col-span-3"
        >
          Reset (Hapus Semua)
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // === State Management ===
        let nodes = [];
        let isAnimating = false;
        let currentAction = null;

        // === DOM Elements ===
        const visualizer = document.getElementById("visualizer");
        const messageBar = document.getElementById("message-bar");
        const nodeCountEl = document.getElementById("node-count");
        const headNameEl = document.getElementById("head-name");
        const tailNameEl = document.getElementById("tail-name");
        const controlButton = document.getElementById("control-button");
        const modalBackdrop = document.getElementById("modal-backdrop");
        const modalSheet = document.getElementById("modal-sheet");
        const actionFormContainer = document.getElementById(
          "action-form-container"
        );
        const actionButtonsGrid = document.getElementById(
          "action-buttons-grid"
        );
        const cancelActionButton = document.getElementById(
          "cancel-action-button"
        );
        const formFields = document.getElementById("form-fields");

        // === Helper Functions ===
        const delay = (ms) => new Promise((res) => setTimeout(res, ms));
        const showMessage = (msg, duration = 3000) => {
          messageBar.textContent = msg;
          if (duration > 0) {
            setTimeout(() => {
              if (messageBar.textContent === msg) {
                messageBar.textContent = "";
              }
            }, duration);
          }
        };

        // === Render Function ===
        const render = () => {
          visualizer.innerHTML = "";
          const head = nodes.length > 0 ? nodes[0] : null;
          const tail = nodes.length > 0 ? nodes[nodes.length - 1] : null;
          nodeCountEl.textContent = nodes.length;
          headNameEl.textContent = head ? head.nama : "null";
          tailNameEl.textContent = tail ? tail.nama : "null";

          if (nodes.length === 0) {
            visualizer.innerHTML = `
                        <div class="text-center w-full text-gray-500">
                            <p>Linked List kosong.</p>
                            <p>Gunakan tombol "Kontrol" untuk menambahkan node baru.</p>
                        </div>`;
            return;
          }

          const listContainer = document.createElement("div");
          listContainer.className = "flex items-center space-x-8 px-4 h-48";

          nodes.forEach((node, index) => {
            const isHead = index === 0;
            const isTail = index === nodes.length - 1;

            const nodeWrapper = document.createElement("div");
            nodeWrapper.className = "flex flex-col items-center";
            nodeWrapper.id = `node-${node.id}`;

            const labelsContainer = document.createElement("div");
            labelsContainer.className =
              "flex text-xs text-center mb-2 space-x-2 h-6";
            if (isHead)
              labelsContainer.innerHTML += `<span class="bg-green-500 text-white px-2 py-1 rounded-full">Head</span>`;
            if (isTail)
              labelsContainer.innerHTML += `<span class="bg-pink-500 text-white px-2 py-1 rounded-full">Tail</span>`;

            const nodeElement = document.createElement("div");
            nodeElement.className =
              "w-40 h-24 rounded-lg flex shadow-lg bg-white transition-all duration-500 ease-in-out transform";
            nodeElement.innerHTML = `
                        <div class="w-2/3 p-2 flex flex-col justify-center text-left">
                            <p class="font-bold truncate">${node.nama}</p>
                            <p class="text-xs text-gray-500">NIM: ${node.nim}</p>
                            <p class="text-xs text-gray-500 truncate">Jur: ${node.jurusan}</p>
                        </div>
                        <div class="w-1/3 bg-gray-100 rounded-r-lg border-l-2 border-gray-200 flex items-center justify-center">
                            <div class="w-3 h-3 bg-teal-400 rounded-full"></div>
                        </div>
                    `;

            nodeWrapper.appendChild(labelsContainer);
            nodeWrapper.appendChild(nodeElement);
            listContainer.appendChild(nodeWrapper);

            if (index < nodes.length - 1) {
              const arrow = document.createElement("div");
              arrow.className = "text-teal-500 text-4xl font-light";
              arrow.textContent = "â†’";
              listContainer.appendChild(arrow);
            }
          });
          visualizer.appendChild(listContainer);
        };

        // === Animation Helpers ===
        const highlightNode = (id, type) => {
          const nodeEl = document.querySelector(`#node-${id} > div:last-child`);
          const labelContainer = document.querySelector(
            `#node-${id} > div:first-child`
          );
          if (!nodeEl) return;

          document.querySelectorAll(".visualizer-highlight").forEach((el) => {
            el.classList.remove(
              "visualizer-highlight",
              "scale-110",
              "bg-sky-300",
              "shadow-lg",
              "shadow-sky-400/50",
              "bg-blue-300",
              "shadow-blue-400/50",
              "bg-red-300",
              "opacity-80",
              "bg-orange-300"
            );
            el.classList.add("bg-white");
          });
          document.querySelectorAll(".anim-label").forEach((el) => el.remove());

          let colorClass = "";
          let shadowClass = "";
          let labelText = "";
          let labelColor = "";

          switch (type) {
            case "traversing":
              colorClass = "bg-sky-300";
              shadowClass = "shadow-sky-400/50";
              break;
            case "before":
              colorClass = "bg-blue-300";
              shadowClass = "shadow-blue-400/50";
              labelText = "Before";
              labelColor = "bg-blue-500";
              break;
            case "del":
              colorClass = "bg-red-300 opacity-80";
              shadowClass = "shadow-red-400/50";
              labelText = "Del";
              labelColor = "bg-red-500";
              break;
            case "editing":
              colorClass = "bg-orange-300";
              shadowClass = "shadow-orange-400/50";
              labelText = "Editing";
              labelColor = "bg-orange-500";
              break;
          }

          nodeEl.classList.add(
            "visualizer-highlight",
            "scale-110",
            colorClass,
            "shadow-lg",
            shadowClass
          );
          nodeEl.classList.remove("bg-white");

          if (labelText) {
            const label = document.createElement("span");
            label.className = `anim-label text-white px-2 py-1 rounded-full ${labelColor}`;
            label.textContent = labelText;
            labelContainer.appendChild(label);
          }
        };

        const resetHighlights = () => {
          document.querySelectorAll(".visualizer-highlight").forEach((el) => {
            el.classList.remove(
              "visualizer-highlight",
              "scale-110",
              "bg-sky-300",
              "shadow-lg",
              "shadow-sky-400/50",
              "bg-blue-300",
              "shadow-blue-400/50",
              "bg-red-300",
              "opacity-80",
              "bg-orange-300"
            );
            el.classList.add("bg-white");
          });
          document.querySelectorAll(".anim-label").forEach((el) => el.remove());
        };

        // === Modal Logic ===
        const openModal = () => {
          modalBackdrop.classList.remove("opacity-0", "pointer-events-none");
          modalSheet.classList.remove("translate-y-full");
        };

        const closeModal = () => {
          modalBackdrop.classList.add("opacity-0", "pointer-events-none");
          modalSheet.classList.add("translate-y-full");
          setTimeout(() => {
            actionFormContainer.classList.add("hidden");
            actionButtonsGrid.classList.remove("hidden");
            currentAction = null;
          }, 300);
        };

        const showFormForAction = (action) => {
          currentAction = action;
          const needsData = action.includes("add") || action.includes("edit");
          const needsPosition = action.includes("Middle");

          formFields.innerHTML = "";

          const inputClasses =
            "w-full bg-gray-100 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500";

          if (needsData) {
            formFields.innerHTML += `<input type="text" name="nama" placeholder="Nama Mahasiswa" class="${inputClasses}" />`;
            formFields.innerHTML += `<input type="text" name="nim" placeholder="NIM" class="${inputClasses} mt-3" />`;
            formFields.innerHTML += `<input type="text" name="jurusan" placeholder="Jurusan" class="${inputClasses} mt-3" />`;
          }
          if (needsPosition) {
            formFields.innerHTML += `<input type="number" name="posisi" placeholder="Posisi (e.g., 2)" class="${inputClasses} mt-3" />`;
          }

          actionButtonsGrid.classList.add("hidden");
          actionFormContainer.classList.remove("hidden");

          setTimeout(() => {
            const firstInput = formFields.querySelector("input");
            if (firstInput) firstInput.focus();
          }, 350);
        };

        // === Initial Load / Reset Function ===
        const initialize = () => {
          nodes = [
            { id: 1, nama: "Ari", nim: "101", jurusan: "Informatika" },
            { id: 2, nama: "Nadhil", nim: "102", jurusan: "Sistem Info" },
            { id: 3, nama: "Tasya", nim: "103", jurusan: "DKV" },
            { id: 4, nama: "Zahratul", nim: "104", jurusan: "Informatika" },
          ];
          showMessage("Linked List berhasil dibuat dengan data awal.");
          render();
        };

        // === Event Listeners ===
        controlButton.addEventListener("click", openModal);
        modalBackdrop.addEventListener("click", closeModal);
        cancelActionButton.addEventListener("click", closeModal);

        actionButtonsGrid.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            const action = e.target.dataset.action;
            if (action === "resetData") {
              closeModal();
              nodes = [];
              render();
              showMessage("Semua data berhasil dihapus.");
            } else {
              showFormForAction(action);
            }
          }
        });

        actionFormContainer.addEventListener("submit", async (e) => {
          e.preventDefault();
          if (isAnimating) return;

          const nama =
            actionFormContainer.querySelector('[name="nama"]')?.value || "";
          const nim =
            actionFormContainer.querySelector('[name="nim"]')?.value || "";
          const jurusan =
            actionFormContainer.querySelector('[name="jurusan"]')?.value || "";
          const pos = parseInt(
            actionFormContainer.querySelector('[name="posisi"]')?.value
          );

          closeModal();
          isAnimating = true;
          controlButton.disabled = true;

          // --- LOGIC FOR ALL ACTIONS ---
          if (currentAction === "addFirst") {
            const newNode = { id: Date.now(), nama, nim, jurusan };
            nodes.unshift(newNode);
            showMessage(`Data ${nama} berhasil ditambahkan di awal.`);
          } else if (currentAction === "addLast") {
            const newNode = { id: Date.now(), nama, nim, jurusan };
            nodes.push(newNode);
            showMessage(`Data ${nama} berhasil ditambahkan di akhir.`);
          } else if (currentAction === "addMiddle") {
            if (isNaN(pos) || pos <= 1 || pos > nodes.length) {
              showMessage("Error: Posisi tidak valid.");
            } else {
              const newNode = { id: Date.now(), nama, nim, jurusan };
              nodes.splice(pos - 1, 0, newNode);
              showMessage(`Data ${nama} ditambahkan di posisi ${pos}.`);
            }
          } else if (currentAction === "deleteFirst") {
            if (nodes.length > 0) {
              const deleted = nodes.shift();
              showMessage(`Data ${deleted.nama} dihapus dari awal.`);
            } else {
              showMessage("Error: List kosong.");
            }
          } else if (currentAction === "deleteLast") {
            if (nodes.length > 0) {
              const deleted = nodes.pop();
              showMessage(`Data ${deleted.nama} dihapus dari akhir.`);
            } else {
              showMessage("Error: List kosong.");
            }
          } else if (currentAction === "deleteMiddle") {
            if (isNaN(pos) || pos <= 1 || pos >= nodes.length) {
              showMessage("Error: Posisi tidak valid.");
            } else {
              showMessage(`Mulai proses hapus posisi ${pos}...`, 0);
              let beforeNodeId;
              for (let i = 0; i < pos - 1; i++) {
                highlightNode(nodes[i].id, "traversing");
                await delay(600);
                if (i === pos - 2) beforeNodeId = nodes[i].id;
              }
              const deleteNodeId = nodes[pos - 1].id;
              highlightNode(beforeNodeId, "before");
              highlightNode(deleteNodeId, "del");
              showMessage(`Node 'before' dan 'del' ditemukan.`);
              await delay(2000);
              const deleted = nodes.splice(pos - 1, 1);
              showMessage(`Data ${deleted[0].nama} berhasil dihapus.`);
            }
          } else if (currentAction === "editFirst") {
            if (nodes.length > 0) {
              nodes[0] = { ...nodes[0], nama, nim, jurusan };
              showMessage(`Data head diubah menjadi ${nama}.`);
            } else {
              showMessage("Error: List kosong.");
            }
          } else if (currentAction === "editLast") {
            if (nodes.length > 0) {
              nodes[nodes.length - 1] = {
                ...nodes[nodes.length - 1],
                nama,
                nim,
                jurusan,
              };
              showMessage(`Data tail diubah menjadi ${nama}.`);
            } else {
              showMessage("Error: List kosong.");
            }
          } else if (currentAction === "editMiddle") {
            if (isNaN(pos) || pos <= 1 || pos >= nodes.length) {
              showMessage("Error: Posisi tidak valid.");
            } else {
              showMessage(`Mencari node di posisi ${pos}...`, 0);
              for (let i = 0; i < pos; i++) {
                highlightNode(nodes[i].id, "traversing");
                await delay(600);
              }
              const editNodeId = nodes[pos - 1].id;
              highlightNode(editNodeId, "editing");
              showMessage(`Node ditemukan. Mengubah data...`);
              await delay(1500);
              nodes[pos - 1] = { ...nodes[pos - 1], nama, nim, jurusan };
              showMessage(`Data di posisi ${pos} diubah menjadi ${nama}.`);
            }
          }

          await delay(500);
          resetHighlights();
          render();
          visualizer.scrollLeft = visualizer.scrollWidth;
          isAnimating = false;
          controlButton.disabled = false;
        });

        // === Final Initialization ===
        initialize();
      });
    </script>
  </body>
</html>
